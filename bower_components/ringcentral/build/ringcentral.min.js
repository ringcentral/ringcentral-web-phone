!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("es6-promise"),require("node-fetch"),require("pubnub")):"function"==typeof define&&define.amd?define([,,"pubnub"],t):"object"==typeof exports?exports.SDK=t(require("es6-promise"),require("node-fetch"),require("pubnub")):(e.RingCentral=e.RingCentral||{},e.RingCentral.SDK=t(e[void 0],e[void 0],e[void 0]))}(this,function(e,t,r){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="/build/",t(0)}([function(e,t,r){r(1),e.exports=r(2)},function(e,t){(function(t){!function(t){"use strict";function r(e,t,r,n){var s=Object.create((t||o).prototype),i=new l(n||[]);return s._invoke=p(e,r,i),s}function n(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(n){return{type:"throw",arg:n}}}function o(){}function s(){}function i(){}function u(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function a(e){this.arg=e}function c(e){function t(t,r){var n=e[t](r),i=n.value;return i instanceof a?Promise.resolve(i.arg).then(o,s):Promise.resolve(i).then(function(e){return n.value=e,n})}function r(e,r){function o(){return t(e,r)}return n=n?n.then(o,o):new Promise(function(e){e(o())})}"object"==typeof process&&process.domain&&(t=process.domain.bind(t));var n,o=t.bind(e,"next"),s=t.bind(e,"throw");t.bind(e,"return");this._invoke=r}function p(e,t,r){var o=g;return function(s,i){if(o===k)throw new Error("Generator is already running");if(o===E){if("throw"===s)throw i;return _()}for(;;){var u=r.delegate;if(u){if("return"===s||"throw"===s&&u.iterator[s]===y){r.delegate=null;var a=u.iterator["return"];if(a){var c=n(a,u.iterator,i);if("throw"===c.type){s="throw",i=c.arg;continue}}if("return"===s)continue}var c=n(u.iterator[s],u.iterator,i);if("throw"===c.type){r.delegate=null,s="throw",i=c.arg;continue}s="next",i=y;var p=c.arg;if(!p.done)return o=x,p;r[u.resultName]=p.value,r.next=u.nextLoc,r.delegate=null}if("next"===s)r._sent=i,o===x?r.sent=i:r.sent=y;else if("throw"===s){if(o===g)throw o=E,i;r.dispatchException(i)&&(s="next",i=y)}else"return"===s&&r.abrupt("return",i);o=k;var c=n(e,t,r);if("normal"===c.type){o=r.done?E:x;var p={value:c.arg,done:r.done};if(c.arg!==T)return p;r.delegate&&"next"===s&&(i=y)}else"throw"===c.type&&(o=E,s="throw",i=c.arg)}}}function f(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function h(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function l(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(f,this),this.reset(!0)}function d(e){if(e){var t=e[b];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function o(){for(;++r<e.length;)if(m.call(e,r))return o.value=e[r],o.done=!1,o;return o.value=y,o.done=!0,o};return n.next=n}}return{next:_}}function _(){return{value:y,done:!0}}var y,m=Object.prototype.hasOwnProperty,b="function"==typeof Symbol&&Symbol.iterator||"@@iterator",v="object"==typeof e,w=t.regeneratorRuntime;if(w)return void(v&&(e.exports=w));w=t.regeneratorRuntime=v?e.exports:{},w.wrap=r;var g="suspendedStart",x="suspendedYield",k="executing",E="completed",T={},R=i.prototype=o.prototype;s.prototype=R.constructor=i,i.constructor=s,s.displayName="GeneratorFunction",w.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return t?t===s||"GeneratorFunction"===(t.displayName||t.name):!1},w.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,i):e.__proto__=i,e.prototype=Object.create(R),e},w.awrap=function(e){return new a(e)},u(c.prototype),w.async=function(e,t,n,o){var s=new c(r(e,t,n,o));return w.isGeneratorFunction(t)?s:s.next().then(function(e){return e.done?e.value:s.next()})},u(R),R[b]=function(){return this},R.toString=function(){return"[object Generator]"},w.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},w.values=d,l.prototype={constructor:l,reset:function(e){if(this.prev=0,this.next=0,this.sent=y,this.done=!1,this.delegate=null,this.tryEntries.forEach(h),!e)for(var t in this)"t"===t.charAt(0)&&m.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=y)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){function t(t,n){return s.type="throw",s.arg=e,r.next=t,!!n}if(this.done)throw e;for(var r=this,n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],s=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var i=m.call(o,"catchLoc"),u=m.call(o,"finallyLoc");if(i&&u){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(i){if(this.prev<o.catchLoc)return t(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&m.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?this.next=o.finallyLoc:this.complete(s),T},complete:function(e,t){if("throw"===e.type)throw e.arg;"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=e.arg,this.next="end"):"normal"===e.type&&t&&(this.next=t)},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),h(r),T}},"catch":function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;h(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:d(e),resultName:t,nextLoc:r},T}}}("object"==typeof t?t:"object"==typeof window?window:"object"==typeof self?self:this)}).call(t,function(){return this}())},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=r(3),u=o(i),a=r(8),c=n(a),p=r(4),f=o(p),h=r(9),l=n(h),d=r(10),_=n(d),y=r(11),m=n(y),b=r(13),v=n(b),w=r(12),g=o(w),x=r(14),k=n(x),E=r(16),T=n(E),R=r(15),S=n(R),O=r(17),P=n(O),j=r(18),C=n(j),q=r(19),M=n(q),F=r(21),L=n(F),I=r(22),N=n(I),A=function(){function e(t){s(this,e),t=t||{},this._cache=new c["default"](f.localStorage,t.cachePrefix),this._client=t.client||new m["default"],this._platform=new P["default"](this._client,this._cache,t.server,t.appKey,t.appSecret),this._pubnubFactory=t.pubnubFactory||f.PUBNUB}return e.prototype.platform=function(){return this._platform},e.prototype.createSubscription=function(){return new L["default"](this._pubnubFactory,this._platform)},e.prototype.createCachedSubscription=function(e){return new N["default"](this._pubnubFactory,this._platform,this._cache,e)},e.prototype.cache=function(){return this._cache},e}();A.version="2.0.3",A.server={sandbox:"https://platform.devtest.ringcentral.com",production:"https://platform.ringcentral.com"},A.core={Cache:c["default"],Observable:l["default"],Utils:u,Externals:f,Queue:_["default"]},A.http={Client:m["default"],ApiResponse:v["default"],Utils:g},A.platform={Auth:C["default"],Platform:P["default"]},A.subscription={Subscription:L["default"]},A.mocks={Client:k["default"],Registry:S["default"],Mock:T["default"]},A.pubnub={PubnubMockFactory:M["default"]},e.exports=A},function(e,t,r){"use strict";function n(e){var t=[];return e=e||{},Object.keys(e).forEach(function(r){var n=e[r];i(n)?n.forEach(function(e){t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n))}),t.join("&")}function o(e){var t={};return e.split("&").forEach(function(e){if(e=decodeURIComponent(e),-1==e.indexOf("="))t[e.trim()]=!0;else{var r=e.split("="),n=r[0].trim(),o=r[1].trim();n in t?(n in t&&!i(t[n])&&(t[n]=[t[n]]),t[n].push(o)):t[n]=o}}),t}function s(e){return"function"==typeof e}function i(e){return Array.isArray?Array.isArray(e):"array"==typeof e}function u(t,r,n){e.exports.stopPolling(n),r=r||1e3;var o=function s(e){return e=e||r,r=e,setTimeout(function(){t(s,e)},e)};return o()}function a(e){e&&clearTimeout(e)}function c(){return"undefined"!=typeof process}function p(){return"undefined"!=typeof window}function f(e){return new h.Promise(function(t,r){setTimeout(function(){t(null)},e)})}t.__esModule=!0,t.queryStringify=n,t.parseQueryString=o,t.isFunction=s,t.isArray=i,t.poll=u,t.stopPolling=a,t.isNodeJS=c,t.isBrowser=p,t.delay=f;var h=r(4)},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0,t.localStorage=t.PUBNUB=t.Headers=t.Response=t.Request=t.fetch=t.Promise=void 0;var o=r(5),s=n(o),i=r(6),u=n(i),a=r(7),c=n(a),p=new Function("return this")(),f=(t.Promise=s["default"]&&s["default"].Promise||p.Promise,t.fetch=p.fetch||u["default"]);t.Request=p.Request||f.Request,t.Response=p.Response||f.Response,t.Headers=p.Headers||f.Headers,t.PUBNUB=p.PUBNUB||c["default"],t.localStorage="undefined"!=typeof p.localStorage?p.localStorage:{}},function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var n=function(){function e(t,n){r(this,e),this.setPrefix(n),this._storage=t}return e.prototype.setPrefix=function(t){return this._prefix=t||e.defaultPrefix,this},e.prototype.setItem=function(e,t){return this._storage[this._prefixKey(e)]=JSON.stringify(t),this},e.prototype.removeItem=function(e){return delete this._storage[this._prefixKey(e)],this},e.prototype.getItem=function(e){var t=this._storage[this._prefixKey(e)];return t?JSON.parse(t):null},e.prototype.clean=function(){for(var e in this._storage)this._storage.hasOwnProperty(e)&&0===e.indexOf(this._prefix)&&delete this._storage[e];return this},e.prototype._prefixKey=function(e){return this._prefix+e},e}();n.defaultPrefix="rc-",t["default"]=n},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var n=function(){function e(){r(this,e),this.off()}return e.prototype.hasListeners=function(e){return e in this._listeners},e.prototype.on=function(e,t){var r=this;if("string"==typeof e&&(e=[e]),!e)throw new Error("No events to subscribe to");if("function"!=typeof t)throw new Error("Callback must be a function");return e.forEach(function(e){r.hasListeners(e)||(r._listeners[e]=[]),r._listeners[e].push(t)}),this},e.prototype.emit=function(e){for(var t=this,r=arguments.length,n=Array(r>1?r-1:0),o=1;r>o;o++)n[o-1]=arguments[o];var s=null;return this.hasListeners(e)?(this._listeners[e].some(function(e){return s=e.apply(t,n),s===!1}),s):null},e.prototype.off=function(e,t){var r=this;if(e)if(t){if(!this.hasListeners(e))return this;this._listeners[e].forEach(function(n,o){n===t&&delete r._listeners[e][o]})}else delete this._listeners[e];else this._listeners={};return this},e}();t["default"]=n},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var o=r(4),s=r(3),i=function(){function e(t,r){n(this,e),this._cache=t,this._cacheId=r,this._promise=null}return e.prototype.isPaused=function(){var t=this._cache.getItem(this._cacheId);return!!t&&Date.now()-parseInt(t)<e._releaseTimeout},e.prototype.pause=function(){return this._cache.setItem(this._cacheId,Date.now()),this},e.prototype.resume=function(){return this._cache.removeItem(this._cacheId),this},e.prototype.poll=function(){var t=this;return this._promise?this._promise:(this._promise=new o.Promise(function(r,n){(0,s.poll)(function(e){return t.isPaused()?e():(t._promise=null,t.resume(),void r(null))},e._pollInterval)}),this._promise)},e}();i._pollInterval=250,i._releaseTimeout=5e3,t["default"]=i},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function o(e){return function(){var t=e.apply(this,arguments);return new a.Promise(function(e,r){function n(o,s){try{var i=t[o](s),u=i.value}catch(c){return void r(c)}i.done?e(u):a.Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)})}n("next")})}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=r(4),c=r(3),p=r(12),f=r(9),h=n(f),l=r(13),d=n(l),_=function(e){function t(){var r,n,o;s(this,t);for(var u=arguments.length,a=Array(u),c=0;u>c;c++)a[c]=arguments[c];return r=n=i(this,e.call.apply(e,[this].concat(a))),n.events={beforeRequest:"beforeRequest",requestSuccess:"requestSuccess",requestError:"requestError"},o=r,i(n,o)}return u(t,e),t.prototype.sendRequest=function(){var e=o(regeneratorRuntime.mark(function t(e){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=new d["default"](e),t.prev=1,this.emit(this.events.beforeRequest,r),t.next=5,this._loadResponse(e);case 5:if(r._response=t.sent,!r._isMultipart()&&!r._isJson()){t.next=10;break}return t.next=9,r.response().text();case 9:r._text=t.sent;case 10:if(r.ok()){t.next=12;break}throw new Error("Response has unsuccessful status");case 12:return this.emit(this.events.requestSuccess,r),t.abrupt("return",r);case 16:throw t.prev=16,t.t0=t["catch"](1),t.t0.apiResponse||(t.t0=this.makeError(t.t0,r)),this.emit(this.events.requestError,t.t0),t.t0;case 21:case"end":return t.stop()}},t,this,[[1,16]])}));return function(t){return e.apply(this,arguments)}}(),t.prototype._loadResponse=function(){var e=o(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.fetch.call(null,e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}(),t.prototype.makeError=function(e,t){return e.hasOwnProperty("apiResponse")||e.hasOwnProperty("originalMessage")||(e.apiResponse=t,e.originalMessage=e.message,e.message=t&&t.error(!0)||e.originalMessage),e},t.prototype.createRequest=function(e){if(e=e||{},e.headers=e.headers||{},!e.url)throw new Error("Url is not defined");if(e.method||(e.method="GET"),e.method&&t._allowedMethods.indexOf(e.method.toUpperCase())<0)throw new Error("Method has wrong value: "+e.method);if(e.credentials=e.credentials||"include",e.mode=e.mode||"cors",e.query&&(e.url=e.url+(e.url.indexOf("?")>-1?"&":"?")+(0,c.queryStringify)(e.query)),(0,p.findHeaderName)("Accept",e.headers)||(e.headers.Accept=d["default"]._jsonContentType),"string"!=typeof e.body||!e.body){var r=(0,p.findHeaderName)(d["default"]._contentType,e.headers);r||(r=d["default"]._contentType,e.headers[r]=d["default"]._jsonContentType);var n=e.headers[r];n.indexOf(d["default"]._jsonContentType)>-1?e.body=JSON.stringify(e.body):n.indexOf(d["default"]._urlencodedContentType)>-1&&(e.body=(0,c.queryStringify)(e.body))}var o=new a.Request(e.url,e);return o.originalBody=e.body,o},t}(h["default"]);_._allowedMethods=["GET","POST","PUT","DELETE","PATCH","OPTIONS","HEAD"],t["default"]=_},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function o(e,t){t=t||{};var r=new i.Response(e,t);return a.isNodeJS()&&(r._text=e,r._decode=function(){return this._text}),r}function s(e,t){return e=e.toLowerCase(),Object.keys(t).reduce(function(t,r){return t?t:e==r.toLowerCase()?r:t},null)}t.__esModule=!0,t.createResponse=o,t.findHeaderName=s;var i=r(4),u=r(3),a=n(u)},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var s=r(4),i=r(12),u=n(i),a=function(){function e(t,r,n){o(this,e),this._request=t,this._response=r,this._text=n,this._json=null,this._multipart=[]}return e.prototype.response=function(){return this._response},e.prototype.request=function(){return this._request},e.prototype.ok=function(){return this._response&&this._response.ok},e.prototype.text=function(){if(!this._isJson()&&!this._isMultipart())throw new Error("Response is not text");return this._text},e.prototype.json=function(){if(!this._isJson())throw new Error("Response is not JSON");return this._json||(this._json=this._text?JSON.parse(this._text):null),this._json},e.prototype.error=function(e){if(this.ok()&&!e)return null;var t=(this._response&&this._response.status?this._response.status+" ":"")+(this._response&&this._response.statusText?this._response.statusText:"");try{this.json().message&&(t=this.json().message),this.json().error_description&&(t=this.json().error_description),this.json().description&&(t=this.json().description)}catch(r){}return t},e.prototype.multipart=function(){if(!this._isMultipart())throw new Error("Response is not multipart");if(!this._multipart.length){var t=this.text();if(!t)throw new Error("No response body");var r=this._getContentType().match(/boundary=([^;]+)/i)[1];if(!r)throw new Error("Cannot find boundary");var n=t.toString().split(e._boundarySeparator+r);if(""===n[0].trim()&&n.shift(),n[n.length-1].trim()==e._boundarySeparator&&n.pop(),n.length<1)throw new Error("No parts in body");var o=e.create(n.shift(),this._response.status,this._response.statusText).json();this._multipart=n.map(function(t,r){var n=o.response[r].status;return e.create(t,n)})}return this._multipart},e.prototype._isContentType=function(e){return this._getContentType().indexOf(e)>-1},e.prototype._getContentType=function(){return this._response.headers.get(e._contentType)||""},e.prototype._isMultipart=function(){return this._isContentType(e._multipartContentType)},e.prototype._isUrlEncoded=function(){return this._isContentType(e._urlencodedContentType)},e.prototype._isJson=function(){return this._isContentType(e._jsonContentType)},e.create=function(t,r,n){t=t||"",r=r||200,n=n||"OK",t=t.replace(/\r/g,"");var o=new s.Headers,i=t.split(e._bodySeparator),a=i.length>1?i.shift():"";return t=i.join(e._bodySeparator),(a||"").split("\n").forEach(function(t){var r=t.trim().split(e._headerSeparator),n=r.shift().trim(),s=r.join(e._headerSeparator).trim();n&&o.append(n,s)}),new e(null,u.createResponse(t,{headers:o,status:r,statusText:n}),t)},e}();a._contentType="Content-Type",a._jsonContentType="application/json",a._multipartContentType="multipart/mixed",a._urlencodedContentType="application/x-www-form-urlencoded",a._headerSeparator=":",a._bodySeparator="\n\n",a._boundarySeparator="--",t["default"]=a},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(o,s){try{var i=t[o](s),u=i.value}catch(a){return void r(a)}i.done?e(u):Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)})}n("next")})}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=r(15),c=n(a),p=r(11),f=n(p),h=function(e){function t(){s(this,t);var r=i(this,e.call(this));return r._registry=new c["default"],r}return u(t,e),t.prototype.registry=function(){return this._registry},t.prototype._loadResponse=function(){var e=o(regeneratorRuntime.mark(function t(e){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=this._registry.find(e),t.next=3,r.getResponse(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}(),t}(f["default"]);t["default"]=h},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var s=r(16),i=n(s),u=function(){function e(){o(this,e),this._mocks=[]}return e.prototype.add=function(e){return this._mocks.push(e),this},e.prototype.clear=function(){return this._mocks=[],this},e.prototype.find=function(e){var t=this._mocks.shift();if(!t)throw new Error("No mock in registry for request "+e.method+" "+e.url);if(!t.test(e))throw new Error("Wrong request "+e.method+" "+e.url+" for expected mock "+t.method()+" "+t.path());return t},e.prototype.apiCall=function(e,t,r,n,o){return this.add(new i["default"](e,t,r,n,o)),this},e.prototype.authentication=function(){return this.apiCall("POST","/restapi/oauth/token",{access_token:"ACCESS_TOKEN",token_type:"bearer",expires_in:3600,refresh_token:"REFRESH_TOKEN",refresh_token_expires_in:60480,scope:"SMS RCM Foo Boo",expireTime:(new Date).getTime()+36e5}),this},e.prototype.logout=function(){return this.apiCall("POST","/restapi/oauth/revoke",{}),this},e.prototype.presenceLoad=function(e){return this.apiCall("GET","/restapi/v1.0/account/~/extension/"+e+"/presence",{uri:"https://platform.ringcentral.com/restapi/v1.0/account/123/extension/"+e+"/presence",extension:{uri:"https://platform.ringcentral.com/restapi/v1.0/account/123/extension/"+e,id:e,extensionNumber:"101"},activeCalls:[],presenceStatus:"Available",telephonyStatus:"Ringing",userStatus:"Available",dndStatus:"TakeAllCalls",extensionId:e}),this},e.prototype.subscribeGeneric=function(e){e=e||54e3;var t=new Date;return this.apiCall("POST","/restapi/v1.0/subscription",{eventFilters:["/restapi/v1.0/account/~/extension/~/presence"],expirationTime:new Date(t.getTime()+1e3*e).toISOString(),expiresIn:e,deliveryMode:{transportType:"PubNub",encryption:!1,address:"123_foo",subscriberKey:"sub-c-foo",secretKey:"sec-c-bar"},id:"foo-bar-baz",creationTime:t.toISOString(),status:"Active",uri:"https://platform.ringcentral.com/restapi/v1.0/subscription/foo-bar-baz"}),this},e.prototype.subscribeOnPresence=function(e,t){e=e||"1";var r=new Date;return this.apiCall("POST","/restapi/v1.0/subscription",{eventFilters:["/restapi/v1.0/account/~/extension/"+e+"/presence"+(t?"?detailedTelephonyState=true":"")],expirationTime:new Date(r.getTime()+54e6).toISOString(),deliveryMode:{transportType:"PubNub",encryption:!0,address:"123_foo",subscriberKey:"sub-c-foo",secretKey:"sec-c-bar",encryptionAlgorithm:"AES",encryptionKey:"VQwb6EVNcQPBhE/JgFZ2zw=="},creationTime:r.toISOString(),id:"foo-bar-baz",status:"Active",uri:"https://platform.ringcentral.com/restapi/v1.0/subscription/foo-bar-baz"}),this},e.prototype.tokenRefresh=function(e){return e?this.apiCall("POST","/restapi/oauth/token",{message:"Wrong token",error_description:"Wrong token",description:"Wrong token"},400):this.apiCall("POST","/restapi/oauth/token",{access_token:"ACCESS_TOKEN_FROM_REFRESH",token_type:"bearer",expires_in:3600,refresh_token:"REFRESH_TOKEN_FROM_REFRESH",refresh_token_expires_in:60480,scope:"SMS RCM Foo Boo"}),this},e}();t["default"]=u},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(o,s){try{var i=t[o](s),u=i.value}catch(a){return void r(a)}i.done?e(u):Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)})}n("next")})}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var i=r(13),u=n(i),a=r(3),c=r(12),p=function(){function e(t,r,n,o,i,u){s(this,e),this._method=t.toUpperCase(),this._path=r,this._json=n||{},this._delay=u||10,this._status=o||200,this._statusText=i||"OK"}return e.prototype.path=function(){return this._path},e.prototype.method=function(){return this._method},e.prototype.test=function(e){return e.url.indexOf(this._path)>-1&&e.method.toUpperCase()==this._method},e.prototype.getResponse=function(){var e=o(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,a.delay)(this._delay);case 2:return e.abrupt("return",this.createResponse(this._json));case 3:case"end":return e.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}(),e.prototype.createResponse=function(e,t){t=t||{},t.status=t.status||this._status,t.statusText=t.statusText||this._statusText;var r=JSON.stringify(e),n=(0,c.createResponse)(r,t);return n.headers.set(u["default"]._contentType,u["default"]._jsonContentType),n},e}();t["default"]=p},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function o(e){return function(){var t=e.apply(this,arguments);return new d.Promise(function(e,r){function n(o,s){try{var i=t[o](s),u=i.value}catch(a){return void r(a)}i.done?e(u):d.Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)})}n("next")})}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=r(9),c=n(a),p=r(10),f=n(p),h=r(18),l=n(h),d=r(4),_=r(3),y=function(e){function t(r,n,o,u,a){s(this,t);var c=i(this,e.call(this));return c.events={beforeLogin:"beforeLogin",loginSuccess:"loginSuccess",loginError:"loginError",beforeRefresh:"beforeRefresh",refreshSuccess:"refreshSuccess",refreshError:"refreshError",beforeLogout:"beforeLogout",logoutSuccess:"logoutSuccess",logoutError:"logoutError"},c._server=o,c._appKey=u,c._appSecret=a,c._cache=n,c._client=r,c._queue=new f["default"](c._cache,t._cacheId+"-refresh"),c._auth=new l["default"](c._cache,t._cacheId),c}return u(t,e),t.prototype.auth=function(){return this._auth},t.prototype.client=function(){return this._client},t.prototype.createUrl=function(e,r){e=e||"",r=r||{};var n="",o=-1!=e.indexOf("http://")||-1!=e.indexOf("https://");return r.addServer&&!o&&(n+=this._server),-1!=e.indexOf(t._urlPrefix)||o||(n+=t._urlPrefix+"/"+t._apiVersion),n+=e,(r.addMethod||r.addToken)&&(n+=e.indexOf("?")>-1?"&":"?"),r.addMethod&&(n+="_method="+r.addMethod),r.addToken&&(n+=(r.addMethod?"&":"")+"access_token="+this._auth.accessToken()),n},t.prototype.authUrl=function(e){return e=e||{},this.createUrl(t._authorizeEndpoint+"?"+(0,_.queryStringify)({response_type:"code",redirect_uri:e.redirectUri||"",client_id:this._appKey,state:e.state||"",brand_id:e.brandId||"",display:e.display||"",prompt:e.prompt||""}),{addServer:!0})},t.prototype.parseAuthRedirectUrl=function(e){var t=(0,_.parseQueryString)(e.split("?").reverse()[0]),r=t.error_description||t.error;if(r){var n=new Error(r);throw n.error=t.error,n}return t},t.prototype.loggedIn=function(){var e=o(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._ensureAuthentication();case 3:return e.abrupt("return",!0);case 6:return e.prev=6,e.t0=e["catch"](0),e.abrupt("return",!1);case 9:case"end":return e.stop()}},t,this,[[0,6]])}));return function(){return e.apply(this,arguments)}}(),t.prototype.login=function(){var e=o(regeneratorRuntime.mark(function r(e){var n,o,s;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,e=e||{},e.remember=e.remember||!1,this.emit(this.events.beforeLogin),n={access_token_ttl:t._accessTokenTtl,refresh_token_ttl:e.remember?t._refreshTokenTtlRemember:t._refreshTokenTtl},e.code?e.code&&(n.grant_type="authorization_code",n.code=e.code,n.redirect_uri=e.redirectUri):(n.grant_type="password",n.username=e.username,n.password=e.password,n.extension=e.extension||""),e.endpointId&&(n.endpoint_id=e.endpointId),r.next=9,this._tokenRequest(t._tokenEndpoint,n);case 9:return o=r.sent,s=o.json(),this._auth.setData(s).setRemember(e.remember),this.emit(this.events.loginSuccess,o),r.abrupt("return",o);case 16:throw r.prev=16,r.t0=r["catch"](0),this._cache.clean(),this.emit(this.events.loginError,r.t0),r.t0;case 21:case"end":return r.stop()}},r,this,[[0,16]])}));return function(t){return e.apply(this,arguments)}}(),t.prototype.refresh=function(){var e=o(regeneratorRuntime.mark(function r(){var e,n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,this.emit(this.events.beforeRefresh),!this._queue.isPaused()){r.next=9;break}return r.next=5,this._queue.poll();case 5:if(this._isAccessTokenValid()){r.next=7;break}throw new Error("Automatic authentification timeout");case 7:return this.emit(this.events.refreshSuccess,null),r.abrupt("return",null);case 9:return this._queue.pause(),r.next=12,(0,_.delay)(t._refreshDelayMs);case 12:if(this._auth.refreshToken()){r.next=14;break}throw new Error("Refresh token is missing");case 14:if(this._auth.refreshTokenValid()){r.next=16;break}throw new Error("Refresh token has expired");case 16:if(this._queue.isPaused()){r.next=18;break}throw new Error("Queue was resumed before refresh call");case 18:return r.next=20,this._tokenRequest(t._tokenEndpoint,{grant_type:"refresh_token",refresh_token:this._auth.refreshToken(),access_token_ttl:t._accessTokenTtl,refresh_token_ttl:this._auth.remember()?t._refreshTokenTtlRemember:t._refreshTokenTtl});case 20:if(e=r.sent,n=e.json(),n.access_token){r.next=24;break}throw this._client.makeError(new Error("Malformed OAuth response"),e);case 24:return this._auth.setData(n),this._queue.resume(),this.emit(this.events.refreshSuccess,e),r.abrupt("return",e);case 30:throw r.prev=30,r.t0=r["catch"](0),r.t0=this._client.makeError(r.t0),t._clearCacheOnRefreshError&&this._cache.clean(),this.emit(this.events.refreshError,r.t0),r.t0;case 36:case"end":return r.stop()}},r,this,[[0,30]])}));return function(){return e.apply(this,arguments)}}(),t.prototype.logout=function(){var e=o(regeneratorRuntime.mark(function r(){var e;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,this.emit(this.events.beforeLogout),this._queue.pause(),r.next=5,this._tokenRequest(t._revokeEndpoint,{token:this._auth.accessToken()});case 5:return e=r.sent,this._queue.resume(),this._cache.clean(),this.emit(this.events.logoutSuccess,e),r.abrupt("return",e);case 12:throw r.prev=12,r.t0=r["catch"](0),this._queue.resume(),this.emit(this.events.logoutError,r.t0),
r.t0;case 17:case"end":return r.stop()}},r,this,[[0,12]])}));return function(){return e.apply(this,arguments)}}(),t.prototype.inflateRequest=function(){var e=o(regeneratorRuntime.mark(function t(e,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=r||{},!r.skipAuthCheck){t.next=3;break}return t.abrupt("return",e);case 3:return t.next=5,this._ensureAuthentication();case 5:return e.headers.set("Authorization",this._authHeader()),t.abrupt("return",e);case 7:case"end":return t.stop()}},t,this)}));return function(t,r){return e.apply(this,arguments)}}(),t.prototype.sendRequest=function(){var e=o(regeneratorRuntime.mark(function t(e,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.inflateRequest(e,r);case 3:return e=t.sent,t.next=6,this._client.sendRequest(e);case 6:return t.abrupt("return",t.sent);case 9:if(t.prev=9,t.t0=t["catch"](0),t.t0.apiResponse&&t.t0.apiResponse.response()&&401==t.t0.apiResponse.response().status){t.next=13;break}throw t.t0;case 13:return this._auth.cancelAccessToken(),t.next=16,this.sendRequest(e,r);case 16:return t.abrupt("return",t.sent);case 17:case"end":return t.stop()}},t,this,[[0,9]])}));return function(t,r){return e.apply(this,arguments)}}(),t.prototype.send=function(){var e=o(regeneratorRuntime.mark(function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.url=this.createUrl(e.url,{addServer:!0}),t.next=3,this.sendRequest(this._client.createRequest(e),e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}(),t.prototype.get=function(){var e=o(regeneratorRuntime.mark(function t(e,r,n){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=n||{},n.method="GET",n.url=e,n.query=r,t.next=6,this.send(n);case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}},t,this)}));return function(t,r,n){return e.apply(this,arguments)}}(),t.prototype.post=function(){var e=o(regeneratorRuntime.mark(function t(e,r,n,o){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=o||{},o.method="POST",o.url=e,o.query=n,o.body=r,t.next=7,this.send(o);case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}},t,this)}));return function(t,r,n,o){return e.apply(this,arguments)}}(),t.prototype.put=function(){var e=o(regeneratorRuntime.mark(function t(e,r,n,o){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=o||{},o.method="PUT",o.url=e,o.query=n,o.body=r,t.next=7,this.send(o);case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}},t,this)}));return function(t,r,n,o){return e.apply(this,arguments)}}(),t.prototype["delete"]=function(){var e=o(regeneratorRuntime.mark(function t(e,r,n){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=n||{},n.method="DELETE",n.url=e,n.query=r,t.next=6,this.send(n);case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}},t,this)}));return function(t,r,n){return e.apply(this,arguments)}}(),t.prototype._tokenRequest=function(){var e=o(regeneratorRuntime.mark(function t(e,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.send({url:e,skipAuthCheck:!0,body:r,method:"POST",headers:{Authorization:"Basic "+this._apiKey(),"Content-Type":"application/x-www-form-urlencoded"}});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}));return function(t,r){return e.apply(this,arguments)}}(),t.prototype._ensureAuthentication=function(){var e=o(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isAccessTokenValid()){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,this.refresh();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}(),t.prototype._isAccessTokenValid=function(){return this._auth.accessTokenValid()&&!this._queue.isPaused()},t.prototype._apiKey=function(){var e=this._appKey+":"+this._appSecret;return"function"==typeof btoa?btoa(e):new Buffer(e).toString("base64")},t.prototype._authHeader=function(){var e=this._auth.accessToken();return this._auth.tokenType()+(e?" "+e:"")},t}(c["default"]);y._urlPrefix="/restapi",y._apiVersion="v1.0",y._accessTokenTtl=null,y._refreshTokenTtl=36e3,y._refreshTokenTtlRemember=604800,y._tokenEndpoint="/restapi/oauth/token",y._revokeEndpoint="/restapi/oauth/revoke",y._authorizeEndpoint="/restapi/oauth/authorize",y._refreshDelayMs=100,y._cacheId="platform",y._clearCacheOnRefreshError=!0,t["default"]=y},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var n=function(){function e(t,n){r(this,e),this._cache=t,this._cacheId=n}return e.prototype.accessToken=function(){return this.data().access_token},e.prototype.refreshToken=function(){return this.data().refresh_token},e.prototype.tokenType=function(){return this.data().token_type},e.prototype.data=function(){return this._cache.getItem(this._cacheId)||{token_type:"",access_token:"",expires_in:0,refresh_token:"",refresh_token_expires_in:0}},e.prototype.setData=function(e){e=e||{};var t=this.data();return Object.keys(e).forEach(function(r){t[r]=e[r]}),t.expire_time=Date.now()+1e3*t.expires_in,t.refresh_token_expire_time=Date.now()+1e3*t.refresh_token_expires_in,this._cache.setItem(this._cacheId,t),this},e.prototype.accessTokenValid=function(){var t=this.data();return t.token_type===e.forcedTokenType||t.expire_time-e.refreshHandicapMs>Date.now()},e.prototype.refreshTokenValid=function(){return this.data().refresh_token_expire_time>Date.now()},e.prototype.cancelAccessToken=function(){return this.setData({access_token:"",expires_in:0})},e.prototype.forceAuthentication=function(){return this.setData({token_type:e.forcedTokenType,access_token:"",expires_in:0,refresh_token:"",refresh_token_expires_in:0}),this},e.prototype.setRemember=function(e){return this.setData({remember:e})},e.prototype.remember=function(){return!!this.data().remember},e}();n.refreshHandicapMs=6e4,n.forcedTokenType="forced",t["default"]=n},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var s=r(20),i=n(s),u=r(4),a=function(){function e(){o(this,e),this.crypto_obj=u.PUBNUB.crypto_obj}return e.prototype.init=function(e){return new i["default"](e)},e}();t["default"]=a},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var u=r(9),a=n(u),c=r(4),p=function(e){function t(r){o(this,t);var n=s(this,e.call(this));return n.options=r,n.crypto_obj=c.PUBNUB.crypto_obj,n}return i(t,e),t.prototype.ready=function(){},t.prototype.subscribe=function(e){this.on("message-"+e.channel,e.message)},t.prototype.unsubscribe=function(e){this.off("message-"+e.channel)},t.prototype.receiveMessage=function(e,t){this.emit("message-"+t,e,"env",t)},t}(a["default"]);t["default"]=p},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(o,s){try{var i=t[o](s),u=i.value}catch(a){return void r(a)}i.done?e(u):Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)})}n("next")})}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=r(9),c=n(a),p=r(11),f=(n(p),r(3)),h=function(e){function t(r,n){s(this,t);var o=i(this,e.call(this));return o.events={notification:"notification",removeSuccess:"removeSuccess",removeError:"removeError",renewSuccess:"renewSuccess",renewError:"renewError",subscribeSuccess:"subscribeSuccess",subscribeError:"subscribeError"},o._pubnubFactory=r,o._platform=n,o._pubnub=null,o._timeout=null,o._subscription={},o}return u(t,e),t.prototype.subscribed=function(){return!!(this._subscription.id&&this._subscription.deliveryMode&&this._subscription.deliveryMode.subscriberKey&&this._subscription.deliveryMode.address)},t.prototype.alive=function(){return this.subscribed()&&Date.now()<this.expirationTime()},t.prototype.expirationTime=function(){return new Date(this._subscription.expirationTime||0).getTime()-t._renewHandicapMs},t.prototype.setSubscription=function(e){return e=e||{},this._clearTimeout(),this._subscription=e,this._pubnub||this._subscribeAtPubnub(),this._setTimeout(),this},t.prototype.subscription=function(){return this._subscription},t.prototype.register=function(){var e=o(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.alive()){e.next=6;break}return e.next=3,this.renew();case 3:return e.abrupt("return",e.sent);case 6:return e.next=8,this.subscribe();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}(),t.prototype.eventFilters=function(){return this._subscription.eventFilters||[]},t.prototype.addEventFilters=function(e){return this.setEventFilters(this.eventFilters().concat(e)),this},t.prototype.setEventFilters=function(e){return this._subscription.eventFilters=e,this},t.prototype.subscribe=function(){var e=o(regeneratorRuntime.mark(function t(){var e,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this._clearTimeout(),this.eventFilters().length){t.next=4;break}throw new Error("Events are undefined");case 4:return t.next=6,this._platform.post("/restapi/v1.0/subscription",{eventFilters:this._getFullEventFilters(),deliveryMode:{transportType:"PubNub"}});case 6:return e=t.sent,r=e.json(),this.setSubscription(r).emit(this.events.subscribeSuccess,e),t.abrupt("return",e);case 12:throw t.prev=12,t.t0=t["catch"](0),t.t0=this._platform.client().makeError(t.t0),this.reset().emit(this.events.subscribeError,t.t0),t.t0;case 17:case"end":return t.stop()}},t,this,[[0,12]])}));return function(){return e.apply(this,arguments)}}(),t.prototype.renew=function(){var e=o(regeneratorRuntime.mark(function t(){var e,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this._clearTimeout(),this.subscribed()){t.next=4;break}throw new Error("No subscription");case 4:if(this.eventFilters().length){t.next=6;break}throw new Error("Events are undefined");case 6:return t.next=8,this._platform.put("/restapi/v1.0/subscription/"+this._subscription.id,{eventFilters:this._getFullEventFilters()});case 8:return e=t.sent,r=e.json(),this.setSubscription(r).emit(this.events.renewSuccess,e),t.abrupt("return",e);case 14:throw t.prev=14,t.t0=t["catch"](0),t.t0=this._platform.client().makeError(t.t0),this.reset().emit(this.events.renewError,t.t0),t.t0;case 19:case"end":return t.stop()}},t,this,[[0,14]])}));return function(){return e.apply(this,arguments)}}(),t.prototype.remove=function(){var e=o(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.subscribed()){t.next=3;break}throw new Error("No subscription");case 3:return t.next=5,this._platform["delete"]("/restapi/v1.0/subscription/"+this._subscription.id);case 5:return e=t.sent,this.reset().emit(this.events.removeSuccess,e),t.abrupt("return",e);case 10:throw t.prev=10,t.t0=t["catch"](0),t.t0=this._platform.client().makeError(t.t0),this.emit(this.events.removeError,t.t0),t.t0;case 15:case"end":return t.stop()}},t,this,[[0,10]])}));return function(){return e.apply(this,arguments)}}(),t.prototype.resubscribe=function(){return this.reset().setEventFilters(this.eventFilters()).subscribe()},t.prototype.reset=function(){return this._clearTimeout(),this.subscribed()&&this._pubnub&&this._pubnub.unsubscribe({channel:this._subscription.deliveryMode.address}),this._subscription={},this},t.prototype._getFullEventFilters=function(){var e=this;return this.eventFilters().map(function(t){return e._platform.createUrl(t)})},t.prototype._setTimeout=function(){var e=this;if(this._clearTimeout(),!this.alive())throw new Error("Subscription is not alive");return(0,f.poll)(function(t){return e.alive()?t():void e.renew()},t._pollInterval,this._timeout),this},t.prototype._clearTimeout=function(){return(0,f.stopPolling)(this._timeout),this},t.prototype._decrypt=function(e){if(!this.subscribed())throw new Error("No subscription");if(this._subscription.deliveryMode.encryptionKey){var t=this._pubnubFactory;e=t.crypto_obj.decrypt(e,this._subscription.deliveryMode.encryptionKey,{encryptKey:!1,keyEncoding:"base64",keyLength:128,mode:"ecb"})}return e},t.prototype._notify=function(e){return this.emit(this.events.notification,this._decrypt(e)),this},t.prototype._subscribeAtPubnub=function(){if(!this.alive())throw new Error("Subscription is not alive");var e=this._pubnubFactory;return this._pubnub=e.init({ssl:!0,subscribe_key:this._subscription.deliveryMode.subscriberKey}),this._pubnub.ready(),this._pubnub.subscribe({channel:this._subscription.deliveryMode.address,message:this._notify.bind(this),connect:function(){}}),this},t}(c["default"]);h._renewHandicapMs=12e4,h._pollInterval=1e4,t["default"]=h},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(o,s){try{var i=t[o](s),u=i.value}catch(a){return void r(a)}i.done?e(u):Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)})}n("next")})}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.__esModule=!0;var c=r(21),p=n(c),f=r(10),h=n(f),l=function(e){function t(r,n,o,u){s(this,t);var c=i(this,e.call(this,r,n));return c._cache=o,c._cacheKey=u,c._renewQueue=new h["default"](c._cache,u+"-renew"),c._resubscribeQueue=new h["default"](c._cache,u+"-resubscribe"),c.events=a({},c.events,{queuedRenewSuccess:"queuedRenewSuccess",queuedRenewError:"queuedRenewError",queuedResubscribeSuccess:"queuedResubscribeSuccess",queuedResubscribeError:"queuedResubscribeError"}),c.on(c.events.renewError,function(){c.resubscribe()}),c.on([c.events.subscribeSuccess,c.events.renewSuccess],function(){c._cache.setItem(c._cacheKey,c.subscription())}),c.on(c.events.removeSuccess,function(){c._cache.removeItem(c._cacheKey)}),c}return u(t,e),t.prototype._queue=function(){var e=o(regeneratorRuntime.mark(function t(e,r,n,o,s){var i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!r.isPaused()){t.next=8;break}return t.next=4,r.poll();case 4:if(this.alive()){t.next=6;break}throw new Error(s);case 6:return this.emit(n,null),t.abrupt("return",null);case 8:return r.pause(),t.next=11,e.call(this);case 11:return i=t.sent,r.resume(),this.emit(n,i),t.abrupt("return",i);case 17:throw t.prev=17,t.t0=t["catch"](0),this.emit(o,t.t0),t.t0;case 21:case"end":return t.stop()}},t,this,[[0,17]])}));return function(t,r,n,o,s){return e.apply(this,arguments)}}(),t.prototype.renew=function(){return this._queue(e.prototype.renew,this._renewQueue,this.events.queuedRenewSuccess,this.events.queuedRenewError,"Subscription is not alive after renew timeout")},t.prototype.resubscribe=function(){return this._queue(e.prototype.resubscribe,this._resubscribeQueue,this.events.queuedResubscribeSuccess,this.events.queuedResubscribeError,"Subscription is not alive after resubscribe timeout")},t.prototype.restore=function(e){var t=this._cache.getItem(this._cacheKey);if(t)try{this.setSubscription(t)}catch(r){}else this.setEventFilters(e);return this},t}(p["default"]);t["default"]=l}])});
//# sourceMappingURL=ringcentral.min.js.map
