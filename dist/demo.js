!function(e){function n(n){for(var t,i,l=n[0],a=n[1],s=n[2],f=0,d=[];f<l.length;f++)i=l[f],r[i]&&d.push(r[i][0]),r[i]=0;for(t in a)Object.prototype.hasOwnProperty.call(a,t)&&(e[t]=a[t]);for(u&&u(n);d.length;)d.shift()();return c.push.apply(c,s||[]),o()}function o(){for(var e,n=0;n<c.length;n++){for(var o=c[n],t=!0,l=1;l<o.length;l++){var a=o[l];0!==r[a]&&(t=!1)}t&&(c.splice(n--,1),e=i(i.s=o[0]))}return e}var t={},r={1:0},c=[];function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,n,o){i.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,n){if(1&n&&(e=i(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var t in e)i.d(o,t,function(n){return e[n]}.bind(null,t));return o},i.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(n,"a",n),n},i.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},i.p="";var l=window.webpackJsonp=window.webpackJsonp||[],a=l.push.bind(l);l.push=n,l=l.slice();for(var s=0;s<l.length;s++)n(l[s]);var u=a;c.push([37,0]),o()}({37:function(e,n,o){const t=o(38),r=o(46);window.jQuery=r,window.SIP=t,r(function(){o(47);const e=o(30),n=o(78)||window.RingCentral.WebPhone;var t=null,c=null,i=null,l=0,a=null,s=null,u=r("#app"),f=r("#template-login"),d=r("#template-auth-flow"),p=r("#template-call"),g=r("#template-incoming"),m=r("#template-accepted"),v=document.getElementById("remoteVideo"),h=document.getElementById("localVideo"),b=!0,w="";function y(e){return r(e.html())}function S(e,n,o,t,r,i,u){return l=u,a=t,localStorage.setItem("webPhoneServer",e||""),localStorage.setItem("webPhoneAppKey",n||""),localStorage.setItem("webPhoneAppSecret",o||""),localStorage.setItem("webPhoneLogin",t||""),localStorage.setItem("webPhoneExtension",r||""),localStorage.setItem("webPhonePassword",i||""),localStorage.setItem("webPhoneLogLevel",l||0),c.get("/restapi/v1.0/account/~/extension/~").then(function(e){return s=e.json(),console.log("Extension info",s),c.post("/client-info/sip-provision",{sipInfo:[{transport:"WSS"}]})}).then(function(e){return e.json()}).then(k).then(F).catch(function(e){console.error("Error in main promise chain"),console.error(e.stack||e)})}function k(e){return e.sipInfo[0]||e.sipInfo,(i=new n(e,{appKey:localStorage.getItem("webPhoneAppKey"),audioHelper:{enabled:!0},logLevel:parseInt(l,10),appName:"WebPhoneDemo",appVersion:"1.0.0",media:{remote:v,local:h},enableQos:!0,enableMediaReportLogging:!0})).userAgent.audioHelper.loadAudio({incoming:"audio/incoming.ogg",outgoing:"audio/outgoing.ogg"}),i.userAgent.audioHelper.setVolume(.3),i.userAgent.on("invite",I),i.userAgent.on("connecting",function(){console.log("UA connecting")}),i.userAgent.on("connected",function(){console.log("UA Connected")}),i.userAgent.on("disconnected",function(){console.log("UA Disconnected")}),i.userAgent.on("registered",function(){console.log("UA Registered")}),i.userAgent.on("unregistered",function(){console.log("UA Unregistered")}),i.userAgent.on("registrationFailed",function(){console.log("UA RegistrationFailed",arguments)}),i.userAgent.on("message",function(){console.log("UA Message",arguments)}),i.userAgent.transport.on("switchBackProxy",function(){console.log("switching back to primary outbound proxy"),i.userAgent.transport.reconnect(!0)}),i.userAgent.transport.on("closed",function(){console.log("WebSocket closed.")}),i.userAgent.transport.on("transportError",function(){console.log("WebSocket transportError occured")}),i.userAgent.transport.on("wsConnectionError",function(){console.log("WebSocket wsConnectionError occured")}),i}function I(e){if(b=!1,console.log("EVENT: Invite",e.request),console.log("To",e.request.to.displayName,e.request.to.friendlyName),console.log("From",e.request.from.displayName,e.request.from.friendlyName),e.request.headers["Alert-Info"]&&"Auto Answer"===e.request.headers["Alert-Info"][0].raw)e.accept().then(function(){A(e)}).catch(function(e){console.error("Accept failed",e.stack||e)});else{var n=y(g).modal({backdrop:"static"});n.find(".answer").on("click",function(){n.find(".before-answer").css("display","none"),n.find(".answered").css("display",""),e.accept().then(function(){n.modal("hide"),A(e)}).catch(function(e){console.error("Accept failed",e.stack||e)})}),n.find(".decline").on("click",function(){e.reject()}),n.find(".toVoicemail").on("click",function(){e.toVoicemail()}),n.find(".forward-form").on("submit",function(o){o.preventDefault(),o.stopPropagation(),e.forward(n.find("input[name=forward]").val().trim()).then(function(){console.log("Forwarded"),n.modal("hide")}).catch(function(e){console.error("Forward failed",e.stack||e)})}),n.find(".reply-form").on("submit",function(o){o.preventDefault(),o.stopPropagation(),e.replyWithMessage({replyType:0,replyText:n.find("input[name=reply]").val()}).then(function(){console.log("Replied"),n.modal("hide")}).catch(function(e){console.error("Reply failed",e.stack||e)})}),e.on("rejected",function(){n.modal("hide")})}}const P=()=>({id:"",from:"",to:"",direction:"",sipData:{toTag:"",fromTag:""}});function A(e){console.log("EVENT: Accepted",e.request),console.log("To",e.request.to.displayName,e.request.to.friendlyName),console.log("From",e.request.from.displayName,e.request.from.friendlyName);var n=y(m).modal(),o=n.find(".info").eq(0),t=n.find("input[name=dtmf]").eq(0),r=n.find("input[name=transfer]").eq(0),l=n.find("input[name=flip]").eq(0),s=(n.find("input[name=conference]").eq(0),setInterval(function(){var n=e.startTime?Math.round((Date.now()-e.startTime)/1e3)+"s":"Ringing";o.text("time: "+n+"\nstartTime: "+JSON.stringify(e.startTime,null,2)+"\n")},1e3));function u(){clearInterval(s),n.modal("hide")}n.find(".increase-volume").on("click",function(){e.ua.audioHelper.setVolume((null!==e.ua.audioHelper.volume?e.ua.audioHelper.volume:.5)+.1)}),n.find(".decrease-volume").on("click",function(){e.ua.audioHelper.setVolume((null!==e.ua.audioHelper.volume?e.ua.audioHelper.volume:.5)-.1)}),n.find(".mute").on("click",function(){e.mute()}),n.find(".unmute").on("click",function(){e.unmute()}),n.find(".hold").on("click",function(){e.hold().then(function(){console.log("Holding")}).catch(function(e){console.error("Holding failed",e.stack||e)})}),n.find(".unhold").on("click",function(){e.unhold().then(function(){console.log("UnHolding")}).catch(function(e){console.error("UnHolding failed",e.stack||e)})}),n.find(".startRecord").on("click",function(){e.startRecord().then(function(){console.log("Recording Started")}).catch(function(e){console.error("Recording Start failed",e.stack||e)})}),n.find(".stopRecord").on("click",function(){e.stopRecord().then(function(){console.log("Recording Stopped")}).catch(function(e){console.error("Recording Stop failed",e.stack||e)})}),n.find(".park").on("click",function(){e.park().then(function(){console.log("Parked")}).catch(function(e){console.error("Park failed",e.stack||e)})}),n.find(".transfer-form").on("submit",function(n){n.preventDefault(),n.stopPropagation(),e.transfer(r.val().trim()).then(function(){console.log("Transferred")}).catch(function(e){console.error("Transfer failed",e.stack||e)})}),n.find(".transfer-form button.warm").on("click",function(o){o.preventDefault(),o.stopPropagation(),e.hold().then(function(){console.log("Placing the call on hold, initiating attended transfer");var o=e.ua.invite(r.val().trim());o.once("accepted",function(){console.log("New call initated. Click Complete to complete the transfer"),n.find(".transfer-form button.complete").on("click",function(n){e.warmTransfer(o).then(function(){console.log("Warm transfer completed")}).catch(function(e){console.error("Transfer failed",e.stack||e)})})})})}),n.find(".flip-form").on("submit",function(n){n.preventDefault(),n.stopPropagation(),e.flip(l.val().trim()).then(function(){console.log("Flipped")}).catch(function(e){console.error("Flip failed",e.stack||e)}),l.val("")}),n.find(".dtmf-form").on("submit",function(n){n.preventDefault(),n.stopPropagation(),e.dtmf(t.val().trim()),t.val("")}),n.find(".startConf").on("click",function(e){U||c.get("/restapi/v1.0/account/~/extension/~/presence?detailedTelephonyState=true").then(e=>{var n=e.json(),o=n.activeCalls[0].partyId,t=n.activeCalls[0].telephonySessionId;(function(e,n){return c.post("/restapi/v1.0/account/~/telephony/conference",{}).then(e=>(w=e.json().session.id,e.json().session.voiceCallToken))})().then(e=>{!function(e,n,o){var t=i.userAgent.invite(e,{fromNumber:a});t.on("accepted",function(){A(t),console.log("Conference call started"),function(e,n){var o="/restapi/v1.0/account/accountId/telephony/sessions/"+w+"/parties/bring-in";return c.post(o,{telephonySessionId:e,partyId:n})}(o,n).then(e=>{console.log("Adding call to conference succesful",e.json())}).catch(function(e){console.error("Conference call failed",e.stack||e)})})}(e,o,t),U=!0})})}),n.find(".hangup").on("click",function(){e.terminate()}),e.on("accepted",function(){console.log("Event: Accepted"),function(e){const n=b?"Outbound":"Inbound";var o=P();o.from=e.request.from.uri.user,o.to=e.request.to.uri.user,o.direction=n,o.id=e.dialog.id.callId,o.sipData.fromTag=e.dialog.id.remoteTag,o.sipData.toTag=e.dialog.id.localTag,localStorage.getItem("activeCallInfo")||localStorage.setItem("activeCallInfo",JSON.stringify(o))}(e)}),e.on("progress",function(){console.log("Event: Progress")}),e.on("rejected",function(){console.log("Event: Rejected"),u()}),e.on("failed",function(){console.log("Event: Failed",arguments),u()}),e.on("terminated",function(){console.log("Event: Terminated"),localStorage.setItem("activeCallInfo",""),u()}),e.on("cancel",function(){console.log("Event: Cancel"),u()}),e.on("refer",function(){console.log("Event: Refer"),u()}),e.on("replaced",function(n){console.log("Event: Replaced: old session",e,"has been replaced with",n),u(),A(n)}),e.on("dtmf",function(){console.log("Event: DTMF")}),e.on("muted",function(){console.log("Event: Muted")}),e.on("unmuted",function(){console.log("Event: Unmuted")}),e.on("connecting",function(){console.log("Event: Connecting")}),e.on("bye",function(){console.log("Event: Bye"),u()})}var q,E,T,C,N,j,R,x,D,U=!1;function F(){var e=y(p),n=e.find("input[name=number]").eq(0),o=e.find("input[name=homeCountry]").eq(0),t=e.find(".username").eq(0),r=e.find(".logout").eq(0),c=e.find(".switch").eq(0);t.html("<dl><dt>Contact</dt><dd>"+s.contact.firstName+" "+s.contact.lastName+"</dd><dt>Company</dt><dd>"+(s.contact.company||"?")+"</dd><dt>Phone Number</dt><dd>"+a+"</dd></dl>"),r.on("click",function(e){i.userAgent.unregister(),e.preventDefault(),location.reload()}),c.on("click",function(e){var n;n=JSON.parse(localStorage.getItem("activeCallInfo")),console.log("Switching active call to current tab: ",n),A(i.userAgent.switchFrom(n))}),n.val(localStorage.getItem("webPhoneLastNumber")||""),e.on("submit",function(e){var t,r;e.preventDefault(),e.stopPropagation(),localStorage.setItem("webPhoneLastNumber",n.val()||""),t=n.val(),r=o.val(),b=!0,r=r||s&&s.regionalSettings&&s.regionalSettings.homeCountry&&s.regionalSettings.homeCountry.id||null,A(i.userAgent.invite(t,{fromNumber:a,homeCountryId:r}))}),u.empty().append(e)}q=y(f),E=y(d),T=E.find("input[name=server]").eq(0),C=E.find("input[name=appKey]").eq(0),N=E.find("input[name=appSecret]").eq(0),j=q.find("input[name=login]").eq(0),R=q.find("input[name=extension]").eq(0),x=q.find("input[name=password]").eq(0),D=E.find("select[name=logLevel]").eq(0),T.val(localStorage.getItem("webPhoneServer")||e.server.sandbox),C.val(localStorage.getItem("webPhoneAppKey")||""),N.val(localStorage.getItem("webPhoneAppSecret")||""),j.val(localStorage.getItem("webPhoneLogin")||""),R.val(localStorage.getItem("webPhoneExtension")||""),x.val(localStorage.getItem("webPhonePassword")||""),D.val(localStorage.getItem("webPhoneLogLevel")||l),q.on("submit",function(n){console.log("Normal Flow"),n.preventDefault(),n.stopPropagation(),function(n,o,r,i,l,a,s){t=new e({appKey:o,appSecret:r,server:n}),c=t.platform(),i&&(i=(i=i.match(/^[+1]/)?i:"1"+i).replace(/\W/g,"")),c.login({username:i,extension:l||null,password:a}).then(function(){return S(n,o,r,i,l,a,s)}).catch(function(e){console.error(e.stack||e)})}(T.val(),C.val(),N.val(),j.val(),R.val(),x.val(),D.val())}),E.on("submit",function(n){console.log("Authorized Flow"),n.preventDefault(),n.stopPropagation(),function(n,o,r,i){var l=decodeURIComponent(window.location.href.split("login",1)+"callback.html");console.log("The redirect uri value :",l),t=new e({appKey:o,appSecret:r,server:n,redirectUri:l});var a=(c=t.platform()).loginUrl();c.loginWindow({url:a}).then(c.login.bind(c)).then(function(){return S(n,o,r,"","","",i)}).catch(function(e){console.error(e.stack||e)})}(T.val(),C.val(),N.val(),D.val())}),u.empty().append(E).append(q)})},78:function(e,n){e.exports=void 0}});
//# sourceMappingURL=demo.js.map